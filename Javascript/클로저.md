### 프로토타입 기반의 언어인 자바스크립트는 클로저를 통해서 클래스 기반 언어처럼 캡슐화, 모듈화 작업을 수행할 수 있다.

# 클로저
- 클로저느 함수와 함수가 선언된 어휘적 환경의 조합이다.
  - 함수 밖에서 선언된 변수를 함수 내부에서 사용할 때 클로저가 생겨난다고 할 수 있다.
```javascript
  function outer() {
    var name = 'js';
    function inner() {
      console.log(name);
    }
    return inner;
  }
  
  var innerFunc = outer();
  innerFunc();
```
- var innerFunc = outer()를 통해 inner함수를 반환받게 되지만 함수가 종료되면 메모리에서 소멸하기 때문에 innerFunc를 호출해도 name에 대한 참조가 메모리에서 소멸하기 때문에 호출이 불가하게 된다.
- 클로저는 이러한(외부변수와 같은) 환경 자체를 통째로 기억하는 공간을 형성한다.
  - 외부 변수를 기억하는 클로저가 생성되어 메모리 어딘가에 위치한다.

# 캡슐화
- 클로저 영역이 별도로 생성되는 모습은 객체를 생성한 모습과 유사하다.
- var는 전역적인 특성으 가지고 있지만, 클로저의 특성을 이용하면 private 변수를 갖는 클래스 형태로 만들 수 있다.
```javascript
  function student(name, score) {
    // var name = name, score = score;
    return {
      setScore: function() {
        score = _score;
      },
      getInfo: function() {
        return { name: name, score: score };
      }
    }
  }
  
  var lee = student('js', 80);
  var kim = student('jjss', 75);
  
  lee.setScore(60);
  
  console.log(lee.getInfo()); // { name: 'js', score: 60 }
  console.log(kim.getInfo()); // { name: 'jjss', score: 75 }
```
- student 함수의 반환 값을 보면, 외부변수(name, score 파라미터)가 함수의 내부(익명함수)에서 사용되는 모습을 보이기 때문에 클로저의 생성을 짐작할 수 있다.
- ![클로저](https://github.com/juuunobae/TIL/blob/main/Javascript/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-03-15%20%EC%98%A4%ED%9B%84%201.42.50.png)
  - 동일한 student 함수이지만 각각의 클로저가 독립적으로 생성된다.
- 프로토타입을 사용한 객체 생성도 가능하지만 클로저를 이용하는 것으로도 클래스 객체의 모습을 흉내낼 수 있다.
- new 함수로 생성한 객체와 다르게 lee나 kim객체의 외부변수, 즉 파라미터인 name이나 score에는 lee.name과 같은 방식으로 직접 접근할 수 없다.

# 싱글톤
> 싱글톤 패턴
> > 인스턴스가 프로그램 내에서 오직 하나만 생성되는 것을 보장하고, 프로그램 어디에서든 이 인스턴스에 접근할 수 있도록 하는 패턴
- 클로저는 함수의 형태를 띄고있기 때문에 즉시실행함수의 모습으로 싱글톤 패턴을 따라할 수 있다.
```javascript
// candle.js

  module.exports = (function() {
    var state = false;
    return {
      on: function() {
        state = true;
      },
      off: function() {
        state = false;
      },
      getState: function() {
        return state;
      }
    }
  })();
```
  ------------- 
```javascript
// index.js

  var candle1 = require('./candle.js');
  console.log(candle1.getState()); // false
  candle1.on();
  console.log(candle1.getState()); // true
  
  
  var candle2 = require('./candle.js');
  console.log(candle2.getState()); // true
```
- candle.js에서 클로저를 생성하는 함수를 모듈화 했다.
- 즉시 실행되었기 때문에 다른 파일에서 여러번 호출하더라도 하나의 클로저 영역을 공유 할 뿐, 각각의 클로저를 생성할 수 없다.
- 하나의 인스턴스만을 공유하는 싱글톤 패턴과 같은 특징을 갖게 된다.

## ***`함수 밖에서 선언된 변수를 함수 내부에서 사용할 때` 클로저가 생성된다.***
